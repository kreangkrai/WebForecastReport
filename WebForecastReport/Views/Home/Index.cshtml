@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Home";
}
<style>
    .highlight {
        font-weight: bold;
    }

    .dataTables_scrollHeadInner, .table {
        width: 100% !important;
    }

    tr, th {
        word-wrap:unset;
        white-space:nowrap;
    }
    #table_stages tr td:nth-of-type(1),
    #table_stages_department tr td:nth-of-type(1),
    #view_table_quotation tr td:nth-of-type(1){
        cursor: pointer;
    }

</style>
<div class="row pt-3">
    <div class="col-md-12 col-xl-12">
        <ul class="nav nav-tabs pb-2" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="tab_a" data-toggle="tab" href="#dashboard_a" role="tab" aria-controls="dashboard_a" aria-selected="true">
                    <b>Dashboard Individual</b>
                </a>
            </li>            
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="tab_c" data-toggle="tab" href="#dashboard_c" role="tab" aria-controls="dashboard_c" aria-selected="false">
                    <b>Dashboard Department</b>
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="tab_b" data-toggle="tab" href="#dashboard_b" role="tab" aria-controls="dashboard_b" aria-selected="false">
                    <b>Performance</b>
                </a>
            </li>
        </ul>
    </div>
    <div class="tab-content container-fluid" id="myTabContent">
        <div class="tab-pane fade show active " id="dashboard_a" role="tabpanel" aria-labelledby="home-tab">
            <div class="row pt-3">
                <div class="col-md-6 col-xl-6">
                    <div class="row">
                        <div class="col-md-3 col-xl-3 pb-3">
                            <select id="years_dashboard" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-4 col-xl-4 pb-3">
                            <select id="sale_name" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-3 col-xl-3 pb-4">
                            <button type="button" id="btn_OK" class="btn btn-primary form-control">OK</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Quotation-Target</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div class="w-100" id="pie_chart_type" style="width:100%;height:250px"></div>
                                        </div>
                                       <div class="col-md-12 col-xl-12">
                                            <div id="pie_chart_target" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won-Lost</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_won" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_lost" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">No go - Quote for Budget</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_nogo" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_quotebudget" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>               
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Pending-Pending In</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                         <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_pending" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_pending_in" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-xl-8">
                            <div class="card" style="height:auto">
                                <div class="card-header">
                                    <span class="card-title">Last Update</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6 col-xl-6 pt-3">
                                            <div class="w-100">
                                                <canvas id="bar_chart_stages" style="height:450px"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-xl-6 pt-2">
                                            <div style="overflow:auto; height:500px">
                                                <table id="table_stages" class="table table-sm cell-border  table-dark  table-bordered display responsive nowrap" style="width:100%;">
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                </div>
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Hitting Rate</span>
                                </div>
                                <div class="card-body">
                                    <div class="row d-flex align-items-center" style="height:100%">                                        
                                         <div class="col-xl-12">
                                            <canvas id="chart_hitting_rate"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Stages</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12 col-xl-12">
                                            <div id="pie_chart_stages"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Pending ALL VS Pending IN</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="w-100">
                                            <canvas id="chart_pending_all_pending_in" style="height:450px"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>  
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Quotation VS Target</span>
                                </div>
                                <div class="card-body">                
                                      <canvas id="chart_quotation_target" style="height:450px"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                 <div class="card-header">
                                    <span class="card-title">Target VS Won</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_target_won" style="height:450px"></canvas>                                  
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Remain Target VS Pending In</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_remaintarget_pending_in" style="height:450px"></canvas>                                         
                                </div>
                            </div> 
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won VS Lost</span>
                                </div>
                                <div class="card-body">                
                                      <canvas id="chart_won_lost" style="height:450px"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                 <div class="card-header">
                                    <span class="card-title">Won & Lost VS No Go</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_stack_wonlost_nogo" style="height:450px"></canvas>                           
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won & Lost VS No Go & Budget</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_stack_wonlost_nogobudget" style="height:450px"></canvas>                                          
                                </div>
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="dashboard_b" role="tabpanel" aria-labelledby="home-tab">
            <div class="row pt-3">
                <div class="col-md-6 col-xl-6">
                    <div class="row">
                        <div class="col-md-3 col-xl-3 pb-3">
                            <select id="years_performance" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-4 col-xl-4 pb-3">
                            <select id="departments" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-3 col-xl-3 pb-4">
                            <button type="button" id="btn_performance_OK" class="btn btn-primary form-control">OK</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-xl-12 pt-2">
                    <div class="row">
                        <div class="col-md-6 col-xl-6">
                            <div class="card bg-dark text-light" style="height:500px">
                                <div class="card-header">
                                    <span class="card-title">Performance</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12 col-xl-12">
                                            <div class="w-100 h-100">
                                                <canvas id="performance_bar"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-6">
                            <div class="card" style="height:500px">
                                <div class="card-header">
                                    <span class="card-title"></span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12 col-xl-12">
                                            <div class="W-100 h-100" style="overflow:auto;">
                                                <table id="table_performance_stack" class="table table-sm cell-border  table-dark  table-bordered display responsive nowrap" style="width:100%;">
                                                    <thead class="text-center" style="background-color:#0F8DF6;color:black">
                                                        <tr>
                                                            <th style="text-align:center;">Sales Name</th>
                                                            <th style="text-align:center;">Target (MB)</th>
                                                            <th style="text-align:center;">Actual (MB)</th>
                                                            <th style="text-align:center;">Actual (%)</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-xl-12 pt-2">
                    <div class="card" style="height:500px">
                        <div class="card-header">
                            <span class="card-title"></span>
                        </div>
                        <div class="card-body">
                            <div style="overflow:auto; height:400px">
                                <table id="table_performance" class="table table-sm cell-border  table-dark  table-bordered display responsive nowrap" style="width:100%;">
                                    <thead class="text-center" style="background-color:#0F8DF6;color:black">
                                        <tr>
                                            <th rowspan="2" style="text-align:center;vertical-align:middle">Department</th>
                                            <th rowspan="2" style="text-align:center;vertical-align:middle">Sale Name</th>
                                            <th colspan="2" style="text-align:center;">Project(MB)</th>
                                            <th colspan="2" style="text-align:center;">Product(MB)</th>
                                            <th colspan="2" style="text-align:center;">Service(MB)</th>
                                            <th colspan="3" style="text-align:center;">Sales Total(MB)</th>
                                        </tr>
                                        <tr>
                                            <th style="text-align:center;">Target</th>
                                            <th style="text-align:center;">Actual</th>
                                            <th style="text-align:center;">Target</th>
                                            <th style="text-align:center;">Actual</th>
                                            <th style="text-align:center;">Target</th>
                                            <th style="text-align:center;">Actual</th>
                                            <th style="text-align:center;">Target</th>
                                            <th style="text-align:center;">Actual</th>
                                            <th style="text-align:center;">%</th>
                                        </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>               
            </div>
        </div>
        <div class="tab-pane fade" id="dashboard_c" role="tabpanel" aria-labelledby="home-tab">
            <div class="row pt-3">
                <div class="col-md-6 col-xl-6">
                    <div class="row">
                        <div class="col-md-3 col-xl-3 pb-3">
                            <select id="years_dashboard_department" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-4 col-xl-4 pb-3">
                            <select id="department_name" class="form-control">
                            </select>
                        </div>
                        <div class="col-md-3 col-xl-3 pb-4">
                            <button type="button" id="btn_department_OK" class="btn btn-primary form-control">OK</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Quotation-Target</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div class="w-100" id="pie_chart_type_department" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-md-12 col-xl-12">
                                            <div id="pie_chart_target_department" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won - Lost</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_won_department" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_lost_department" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">No go - Quote for Budget</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_nogo_department" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-xl-12 d-flex justify-content-center">
                                            <div id="pie_chart_quotebudget_department" style="width:100%;height:250px"></div>                                           
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>               
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Pending ALL-Pending IN</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12 col-xl-12">
                                            <div id="pie_chart_pending_department" style="width:100%;height:250px"></div>
                                        </div>
                                        <div class="col-md-12 col-xl-12">
                                            <div id="pie_chart_pending_in_department" style="width:100%;height:250px"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-xl-8">
                            <div class="card" style="height:auto">
                                <div class="card-header">
                                    <span class="card-title">Last Update</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6 col-xl-6 pt-3">
                                            <div class="w-100">
                                                <canvas id="bar_chart_stages_department" style="height:450px"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-xl-6 pt-2">
                                            <div style="overflow:auto; height:500px">
                                                <table id="table_stages_department" class="table table-sm cell-border  table-dark  table-bordered display responsive nowrap" style="width:100%;">
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>               
                <div class="col-md-12 col-xl-12">
                    <div class="row">                        
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Hitting Rate</span>
                                </div>
                                <div class="card-body">
                                    <div class="row d-flex align-items-center" style="height:100%"> 
                                        <div class="col-xl-12">
                                            <canvas id="chart_hitting_rate_department"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                 <div class="card-header">
                                    <span class="card-title">Stages</span>
                                </div>
                                <div class="card-body">
                                     <div id="pie_chart_stages_department"></div>                                      
                                </div>
                            </div>
                        </div>                      
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Pending ALL VS Pending IN</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="w-100">
                                            <canvas id="chart_pending_all_pending_in_department" style="height:450px"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>                       
                    </div>
                </div>
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Quotation VS Target</span>
                                </div>
                                <div class="card-body">                
                                      <canvas id="chart_quotation_target_department" style="height:450px"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                 <div class="card-header">
                                    <span class="card-title">Target VS Won</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_target_won_department" style="height:450px"></canvas>                                  
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Remain Target VS Pending In</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_remaintarget_pending_in_department" style="height:450px"></canvas>                                         
                                </div>
                            </div> 
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-xl-12">
                    <div class="row">
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won VS Lost</span>
                                </div>
                                <div class="card-body">                
                                      <canvas id="chart_won_lost_department" style="height:450px"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                 <div class="card-header">
                                    <span class="card-title">Won & Lost VS No Go</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_stack_wonlost_nogo_department" style="height:450px"></canvas>                           
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-xl-4">
                            <div class="card" style="height:600px">
                                <div class="card-header">
                                    <span class="card-title">Won & Lost VS No Go & Budget</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="chart_stack_wonlost_nogobudget_department" style="height:450px"></canvas>                                          
                                </div>
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<partial name="QuotationModal"/>
<partial name="DataModal"/>

@section Scripts
{
    <script type="text/javascript">
        var Years = [];
        var Sales = [];
        var Departments = [];
        var Role = "";
        var Datas = [];
        var Data_Stages = [];
        var Data_Stages_Day = [];
        var Data_Target = [];

        var pie_chart_type;
        var pie_chart_won;
        var bar_chart_stages;     
       
        var DataLastUpdateDepartment = [];
        var last_dashboard_deprtment_index = 0;
        var last_perfomance_deprtment_index = 0;

        $(document).ready(function () {
            init();
        });

        function init(){
            var year = '@DateTime.Now.ToString("yyyy")';
            var name = '@Model.name';
            var role = '@Model.role';
            var department = '@Model.department';
            Role = role;
            $.ajax({
                url: '@Url.Action("GetUserDepartment", "Home")',
                type: "post",
                contentType: 'application/x-www-form-urlencoded',
                data: {
                    year,name,department, role
                },
                success: function (response) {
                    Years = add_year(response.years);
                    Sales = add_sale(response.sales);
                    Departments = add_department(response.departments);

                    initSale(role,Sales);
                    initYearDashboard(Years);
                    //draw pie chart
                    var name = document.getElementById("sale_name").value;
                    pie_chart_data(year,name);
                }
            });
        };

        $('#btn_OK').on('click', function () {
            $("#table_stages").empty();
             var name = document.getElementById("sale_name").value;
             var year = document.getElementById("years_dashboard").value;
             pie_chart_data(year,name);
        });

        $('#tab_b').on('click',function(){
             initDepartment(Role,Departments);
             initYearPerformance(Years);
        });

        $('#tab_c').on('click',function(){
             initDashboardDepartment(Role,Departments);
             initYearDashboardDepartment(Years);
        });

        $('#btn_performance_OK').on('click',function(){
            var year = document.getElementById("years_performance").value;
            var department = document.getElementById("departments").value;
            last_perfomance_deprtment_index = document.getElementById("departments").selectedIndex;
            $.ajax({
                url: '@Url.Action("GetDataPerformance", "Home")',
                type: "post",
                contentType: 'application/x-www-form-urlencoded',
                data: {
                    year,department
                },
                success: function (response) {

                    UpdatePerformanceStack(response.performances_stack);
                    initPerformanceStack(response.performances_stack);

                    var datas = response.performances;
                    var dataSet = [];
                    for (var i = 0; i < datas.length; i++) {
                           var sum_target = (parseFloat(datas[i].product_target) + parseFloat(datas[i].project_target) +  parseFloat(datas[i].service_target)).toFixed(3);
                           var sum_actual = (parseFloat(datas[i].product_actual) + parseFloat(datas[i].project_actual) +  parseFloat(datas[i].service_actual)).toFixed(3);
                           var percent = ((sum_actual / sum_target) * 100).toFixed(2);
                           var data = [
                               datas[i].department,
                               datas[i].sale_name,
                               datas[i].project_target,
                               datas[i].project_actual,
                               datas[i].product_target,
                               datas[i].product_actual,
                               datas[i].service_target,
                               datas[i].service_actual,
                               sum_target,sum_actual,
                               percent
                               ];

                           dataSet.push(data);
                       }
                    tablePerformance(dataSet);
                }
            });
        });

        $('#btn_department_OK').on('click',function(){
            $("#table_stages_department").empty();
            var department = document.getElementById("department_name").value;
            var year = document.getElementById("years_dashboard_department").value;
            chart_data_department(year,department);
            last_dashboard_deprtment_index = document.getElementById("department_name").selectedIndex;
        });

        $('#table_stages').on('click', 'tbody td', function () {
            var cell = tables.cell(this);
            var column = cell[0][0].column;  //quotation column

            if (column == 0){
                var quotation = cell.data();
                $.ajax({
                    url: '@Url.Action("GetViewQuotationByNo", "Home")',
                    type: "post",
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        quotation
                    },
                    success: function (response) {
                        viewPendingQuotation(response.quotation);
                    }
                });
            }
        });

        $('#table_stages_department').on('click', 'tbody td', function () {
            var cell = tables_Lastupdate_department.cell(this);
            var column = cell[0][0].column; //quotation column

            if (column == 0){
                var quotation = cell.data();
                $.ajax({
                    url: '@Url.Action("GetViewQuotationByNo", "Home")',
                    type: "post",
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        quotation
                    },
                    success: function (response) {
                        viewPendingQuotation(response.quotation);
                    }
                });
            }
        });

         $('#view_table_quotation').on('click', 'tbody td', function () {
            var cell = tables_quotation.cell(this);
            var column = cell[0][0].column; //quotation column

            if (column == 0){
                var quotation = cell.data();
                $.ajax({
                    url: '@Url.Action("GetViewQuotationByNo", "Home")',
                    type: "post",
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        quotation
                    },
                    success: function (response) {
                        viewPendingQuotation(response.quotation);
                    }
                });
            }
        });

        function viewPendingQuotation(quotation){
            var arrProductType = [];
            var arrEngineer = [];

            var count = (quotation.brand.match(/\|/g) || []).length;
            for (var i = 0; i <= count; i++) {
                if (quotation.brand != "") {
                    var _type = quotation.type.split('|')[i];
                    var _brand = quotation.brand.split('|')[i];
                    var _part_no = quotation.part_no.split('|')[i];
                    var _spec = quotation.spec.split('|')[i];
                    var _quantity = quotation.quantity.split('|')[i];
                    var _supplier = quotation.supplier_quotation_no.split('|')[i];
                    var _total_value = quotation.total_value.split('|')[i];
                    var _unit = quotation.unit.split('|')[i];

                    arrProductType.push([{"edit":"",
                                            "delete":"",
                                            "type":_type,
                                            "brand":_brand,
                                            "part_no":_part_no,
                                            "spec":_spec,
                                            "quantity":_quantity,
                                            "supplier_quotation_no":_supplier,
                                            "total_value":_total_value,
                                            "unit":_unit}]);
                }
            }

            var count_engineer = (quotation.engineer_in_charge.match(/\|/g) || []).length;
            for (var i = 0; i <= count_engineer; i++) {
                if (quotation.engineer_in_charge != "") {
                    var _engineer_in_charge = quotation.engineer_in_charge.split('|')[i];
                    var _engineer_department = quotation.engineer_department.split('|')[i];

                    arrEngineer.push([{
                        "delete": "",
                        "engineer": _engineer_in_charge,
                        "department": _engineer_department
                    }]);
                }
            }

            document.getElementById('quotation_no').value = quotation.quotation_no;
            document.getElementById('revision').value = quotation.revision;
            document.getElementById('date').value = quotation.date;
            document.getElementById('customer').value = quotation.customer;
            document.getElementById('enduser').value = quotation.enduser;
            document.getElementById('project_name').value = quotation.project_name;
            document.getElementById('site_location').value = quotation.site_location;
            document.getElementById('product_type').value = quotation.product_type;

            document.getElementById('quoted_price').value = quotation.quoted_price;
            document.getElementById('expected_order_date').value = quotation.expected_order_date;
            document.getElementById('required_onsite_date').value = quotation.required_onsite_date;
            document.getElementById('proposer').value = quotation.proposer;
            document.getElementById('expected_date').value = quotation.expected_date;
            document.getElementById('status').value = quotation.status;
            document.getElementById('stages').value = quotation.stages;
            document.getElementById('stages_update_date').value = quotation.stages_update_date;
            document.getElementById('how_to_support').value = quotation.how_to_support;
            document.getElementById('competitor').value = quotation.competitor;
            document.getElementById('competitor_description').value = quotation.competitor_description;
            document.getElementById('competitor_price').value = quotation.competitor_price;
            document.getElementById('sale_name_view').value = quotation.sale_name;

            document.getElementById('department_view').innerHTML = quotation.department;

            document.getElementById('detail').value = quotation.detail;

            //exclude quote
            if (quotation.exclude_quote){
                 document.getElementById("view_chk_exclude_quote").checked = true;
            }else{
                 document.getElementById("view_chk_exclude_quote").checked = false;
            }

            //init data table view
            //Product type view();
            var dataSet = [];
            for (var i = 0; i < arrProductType.length; i++) {
                var data = [arrProductType[i][0].type,arrProductType[i][0].brand, 
                arrProductType[i][0].part_no, 
                arrProductType[i][0].spec, 
                arrProductType[i][0].quantity, 
                arrProductType[i][0].supplier_quotation_no, 
                arrProductType[i][0].total_value, 
                arrProductType[i][0].unit];
                dataSet.push(data);
            }
            table_view(dataSet);

            //engineer_view;

            var dataSet = [];

            for (var i = 0; i < arrEngineer.length; i++) {
                var data = [arrEngineer[i][0].engineer, 
                arrEngineer[i][0].department];
                dataSet.push(data);
            }
            table_engineer_view(dataSet);

            $('#ShowDataModal').modal();
        };
        function initSale(role,Sales){
            $('#sale_name').empty();
            var name = '@Model.name';
            var selectsale = document.getElementById('sale_name');
            if (role == "Admin"){               
                for (var i = 0, l = Sales.length; i < l; i++) {
                     var option = Sales[i];
                     selectsale.options.add(new Option(option.text, option.value, option.selected));
                }
                document.getElementById('sale_name').selectedIndex = 0;
            }else if (role != "Admin" && role != "" && role != null){     
                for (var i = 0, l = Sales.length; i < l; i++) {
                     var option = Sales[i];
                     selectsale.options.add(new Option(option.text, option.value, option.selected));
                }
                var index_sale = Sales.map(function (e) { return e.value; }).indexOf(name);
                document.getElementById('sale_name').selectedIndex = index_sale;         
            }else{               
                selectsale.options.add(new Option(name, name, null));
                document.getElementById('sale_name').selectedIndex = 0;
            }
        };
        function initDepartment(role,Departments){
            //Department
            $('#departments').empty();
            if(role == "Admin"){
                  var selectdepartment = document.getElementById('departments');
                for (var i = 0, l = Departments.length; i < l; i++) {
                 var option = Departments[i];
                 selectdepartment.options.add(new Option(option.text, option.value, option.selected));
                }
                document.getElementById('departments').selectedIndex = last_perfomance_deprtment_index;

            }else{
                  var selectdepartment = document.getElementById('departments');
                  selectdepartment.options.add(new Option(Departments[0].text, Departments[0].value, null));
                  document.getElementById('departments').selectedIndex = last_perfomance_deprtment_index;
            }
        };
        function initDashboardDepartment(role,Departments){
            //Department
            $('#department_name').empty();
            if(role == "Admin"){
                  var selectdepartment = document.getElementById('department_name');
                  selectdepartment.options.add(new Option("ALL", "ALL", true));
                for (var i = 0, l = Departments.length; i < l; i++) {
                    var option = Departments[i];
                    selectdepartment.options.add(new Option(option.text, option.value, option.selected));
                }
                document.getElementById('department_name').selectedIndex = last_dashboard_deprtment_index;

            }else{
                  var selectdepartment = document.getElementById('department_name');
                  selectdepartment.options.add(new Option(Departments[0].text, Departments[0].value, null));
                  document.getElementById('department_name').selectedIndex = last_dashboard_deprtment_index;
            }
        };

        function initYearDashboard(Years){
            //Year
            $('#years_dashboard').empty();
            var selectyear = document.getElementById('years_dashboard');
            for (var i = 0, l = Years.length; i < l; i++) {
                 var option = Years[i];
                 selectyear.options.add(new Option(option.text, option.value, option.selected));
            }
            document.getElementById('years_dashboard').selectedIndex = 0;
        };

        function initYearDashboardDepartment(Years){
            //Year
            $('#years_dashboard_department').empty();
            var selectyear = document.getElementById('years_dashboard_department');
            for (var i = 0, l = Years.length; i < l; i++) {
                 var option = Years[i];
                 selectyear.options.add(new Option(option.text, option.value, option.selected));
            }
            document.getElementById('years_dashboard_department').selectedIndex = 0;
        };


        function initYearPerformance(Years){
            //Year
            $('#years_performance').empty();
            var selectyear = document.getElementById('years_performance');
            for (var i = 0, l = Years.length; i < l; i++) {
                 var option = Years[i];
                 selectyear.options.add(new Option(option.text, option.value, option.selected));
            }
            document.getElementById('years_performance').selectedIndex = 0;
        };

       
        function pie_chart_data(year,name){
            $.ajax({
                 url: '@Url.Action("GetDataByIndividual", "Home")',
                 type: "post",
                 contentType: 'application/x-www-form-urlencoded',
                 data: {
                     year,name
                 },
                 success: function (response) {
                     Datas = response.datas;
                     Data_Stages = response.stages;
                     Data_Stages_Day = response.day;
                     Data_Target = response.target;

                     var Hitting_Rates = response.hittingrates;


                     //============ Start global variable ======================
                     // Quotation

                     var product = {};
                     var project = {};
                     var service = {};

                     var _product = Datas.find(x => x.type === "Product" && x.stages === "");
                     var _project = Datas.find(x => x.type === "Project" && x.stages === "");
                     var _service = Datas.find(x => x.type === "Service" && x.stages === "");
                     if (typeof _product !== 'undefined') {
                         product = _product;
                     }
                     if (typeof _project !== 'undefined') {
                         project = _project;
                     }
                     if (typeof _service !== 'undefined') {
                         service = _service;
                     }

                     //========== Target ==============
                     var target_product = "0";
                     var target_project = "0";
                     var target_service = "0";
                     if (Data_Target.sale_name !== null){
                          target_product = Data_Target.product;
                          target_project = Data_Target.project;
                          target_service = Data_Target.service;
                     }
                     var target = {};
                     var quotation = {};
                     var label_target = ["Tar. Product","Tar Project","Tar. Service"];
                     var label_quotation = ["Quo. Product","Quo. Project","Quo. Service"];
                     target.product = target_product;
                     target.project = target_project;
                     target.service = target_service;
                     quotation.product = product; 
                     quotation.project = project; 
                     quotation.service = service; 

                     // Pending All , Pending In
                     var pending_in = {};
                     var pending_all = {};
                     var label_pending_in = ["Product In","Project In","Service In"];
                     var label_pending_all = ["Product All","Project All","Service All"];

                     var _pending_in_product = Datas.find(x => x.type === "Product" && x.stages === "Pending In");
                     var _pending_in_project = Datas.find(x => x.type === "Project" && x.stages === "Pending In");
                     var _pending_in_service = Datas.find(x => x.type === "Service" && x.stages === "Pending In");
                     var _pending_all_product = Datas.find(x => x.type === "Product" && x.stages === "Pending");
                     var _pending_all_project = Datas.find(x => x.type === "Project" && x.stages === "Pending");
                     var _pending_all_service = Datas.find(x => x.type === "Service" && x.stages === "Pending");

                     
                     if (typeof _pending_in_product !== 'undefined') {
                         pending_in.product = _pending_in_product;
                     }else{
                          pending_in.product = {'mb':'0','cnt':'0'};                    
                     }
                     if (typeof _pending_in_project !== 'undefined') {
                         pending_in.project = _pending_in_project;
                     }else{
                          pending_in.project = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_in_service !== 'undefined') {
                         pending_in.service = _pending_in_service;
                     }else{
                          pending_in.service = {'mb':'0','cnt':'0'};
                     }

                     if (typeof _pending_all_product !== 'undefined') {
                         pending_all.product = _pending_all_product;
                     }else{
                         pending_all.product = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_all_project !== 'undefined') {
                         pending_all.project = _pending_all_project;
                     }else{
                          pending_all.project = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_all_service !== 'undefined') {
                         pending_all.service = _pending_all_service;
                     }else{
                          pending_all.service = {'mb':'0','cnt':'0'};
                     }

                     //============ End global variable ======================

                     //draw quotation
                    
                     UpdatePieChartQuotation(product,project,service,"pie_chart_type");
                   
                     //draw target
                    
                     UpdatePieChartTarget(target_product,target_project,target_service,"pie_chart_target");

                     //draw quotation vs target

                     var chart_name = "chart_quotation_target";
                     var quotation = {product,project,service};

                     UpdateChartBarQuotation_Target(quotation,target,chart_name);

                     //draw pending all vs pending in
                     var chart_name = "chart_pending_all_pending_in";                    

                     UpdateChartBarPending_all_Pending_In(pending_all,pending_in,chart_name);

                     
                     // draw Won
                     var won_product = {};
                     var won_project = {};
                     var won_service = {};

                     var _won_product = Datas.find(x => x.type === "Product" && x.stages === "Closed(Won)");
                     var _won_project = Datas.find(x => x.type === "Project" && x.stages === "Closed(Won)");
                     var _won_service = Datas.find(x => x.type === "Service" && x.stages === "Closed(Won)");


                     if (typeof _won_product !== 'undefined') {
                         won_product = _won_product;
                     }
                     if (typeof _won_project !== 'undefined') {
                         won_project = _won_project;
                     }
                     if (typeof _won_service !== 'undefined') {
                         won_service = _won_service;
                     }
                     UpdatePieChartWon(won_product,won_project,won_service,"pie_chart_won");

                     //draw target vs won
                     var chart_name = "chart_target_won";
                     var won = {'product': won_product,'project':won_project,'service':won_service};

                     UpdateChartBarTarget_Won(target,won,chart_name);
                     
                     //draw reamin target vs pending in

                     var chart_name = "chart_remaintarget_pending_in";
                     var remain_target_product = (target.product - won_product.mb).toFixed(2);
                     var remain_target_project = (target.project - won_project.mb).toFixed(2);
                     var remain_target_service = (target.service - won_service.mb).toFixed(2);
                     var remain_target = {'product':remain_target_product,'project':remain_target_project,'service':remain_target_service};

                     UpdateChartBarRemainTarget_PendingIn(remain_target,pending_in,chart_name);

                     //draw lost
                     var lost_product = {};
                     var lost_project = {};
                     var lost_service = {};

                     var _lost_product = Datas.find(x => x.type === "Product" && x.stages === "Closed(Lost)");
                     var _lost_project = Datas.find(x => x.type === "Project" && x.stages === "Closed(Lost)");
                     var _lost_service = Datas.find(x => x.type === "Service" && x.stages === "Closed(Lost)");

                     if (typeof _lost_product !== 'undefined') {
                         lost_product = _lost_product;
                     }
                     if (typeof _lost_project !== 'undefined') {
                         lost_project = _lost_project;
                     }
                     if (typeof _lost_service !== 'undefined') {
                         lost_service = _lost_service;
                     }
                     UpdatePieChartLost(lost_product,lost_project,lost_service,"pie_chart_lost");

                     //draw won vs lost
                     var chart_name = "chart_won_lost";
                     var won = {'product':won_product,'project':won_project,'service':won_service};
                     var lost = {'product':lost_product,'project':lost_project,'service':lost_service};

                     UpdateChartBarWon_Lost(won,lost,chart_name);

                     // draw nogo
                     var nogo_product = {};
                     var nogo_project = {};
                     var nogo_service = {};

                     var _nogo_product = Datas.find(x => x.type === "Product" && x.stages === "No go");
                     var _nogo_project = Datas.find(x => x.type === "Project" && x.stages === "No go");
                     var _nogo_service = Datas.find(x => x.type === "Service" && x.stages === "No go");

                     if (typeof _nogo_product !== 'undefined') {
                         nogo_product = _nogo_product;
                     }
                     if (typeof _nogo_project !== 'undefined') {
                         nogo_project = _nogo_project;
                     }
                     if (typeof _nogo_service !== 'undefined') {
                         nogo_service = _nogo_service;
                     }
                     UpdatePieChartNogo(nogo_product,nogo_project,nogo_service,"pie_chart_nogo");

                     //draw pending
                     UpdatePieChartPending(pending_all.product,pending_all.project,pending_all.service,"pie_chart_pending");

                     // draw pending in
                     UpdatePieChartPendingIn(pending_in.product,pending_in.project,pending_in.service,"pie_chart_pending_in");

                     // draw all stages
                     var stages_won = {};
                     var stages_lost = {};
                     var stages_negotiation_review = {};
                     var stages_nogo = {};
                     var stages_quote_for_budget = {};
                     var stages_proposal = {};
                     var stages_prospectng = {};

                     var _stages_won = Data_Stages.find(x => x.stages === "Closed(Won)");
                     var _stages_lost = Data_Stages.find(x => x.stages === "Closed(Lost)");
                     var _stages_negotiation_review = Data_Stages.find(x => x.stages === "Negotiation/Review");
                     var _stages_nogo = Data_Stages.find(x => x.stages === "No go");
                     var _stages_quote_for_budget = Data_Stages.find(x => x.stages === "Quote for Budget");
                     var _stages_proposal = Data_Stages.find(x => x.stages === "Proposal/Quote for Order");
                     var _stages_prospectng = Data_Stages.find(x => x.stages === "Prospecting");

                     if (typeof _stages_won !== 'undefined') {
                         stages_won = _stages_won;
                     }
                     if (typeof _stages_lost !== 'undefined') {
                         stages_lost = _stages_lost;
                     }
                     if (typeof _stages_negotiation_review !== 'undefined') {
                         stages_negotiation_review = _stages_negotiation_review;
                     }
                     if (typeof _stages_nogo !== 'undefined') {
                         stages_nogo = _stages_nogo;
                     }
                     if (typeof _stages_quote_for_budget !== 'undefined') {
                         stages_quote_for_budget = _stages_quote_for_budget;
                     }
                     if (typeof _stages_proposal !== 'undefined') {
                         stages_proposal = _stages_proposal;
                     }
                     if (typeof _stages_prospectng !== 'undefined') {
                         stages_prospectng = _stages_prospectng;
                     }
                     UpdatePieChartStages(stages_quote_for_budget,stages_negotiation_review,stages_proposal,
                     stages_prospectng,stages_won,stages_lost,stages_nogo,"pie_chart_stages");                   
                                        
                     PopulateDataBarChart(Data_Stages_Day);
                     UpdateChartHittingRateIndividual(Hitting_Rates,"chart_hitting_rate");

                     //draw stage Quote for Budget
                     var quote_product = {};
                     var quote_project = {};
                     var quote_service = {};

                     var _quote_product = Datas.find(x => x.type === "Product" && x.stages === "Quote for Budget");
                     var _quote_project = Datas.find(x => x.type === "Project" && x.stages === "Quote for Budget");
                     var _quote_service = Datas.find(x => x.type === "Service" && x.stages === "Quote for Budget");

                     if (typeof _quote_product !== 'undefined') {
                         quote_product = _quote_product;
                     }
                     if (typeof _quote_project !== 'undefined') {
                         quote_project = _quote_project;
                     }
                     if (typeof _quote_service !== 'undefined') {
                         quote_service = _quote_service;
                     }
                     UpdatePieChartQuoteForBudget(quote_product,quote_project,quote_service,"pie_chart_quotebudget");

                     // draw won & lost VS No go  | draw won & lost vs no go & budget

                     var chart_name = "chart_stack_wonlost_nogo";
                     var won = {'product':won_product,'project':won_project,'service':won_service};
                     var lost = {'product':lost_product,'project':lost_project,'service':lost_service};
                     var nogo = {'product':nogo_product,'project':nogo_project,'service':nogo_service};
                     var budget = {'product':quote_product,'project':quote_project,'service':quote_service};

                     var chart_name1 = "chart_stack_wonlost_nogobudget";
                     UpdateChartStackWonLost_NOGO(won,lost,nogo,chart_name);
                     UpdateChartStackWonLost_NOGOBudget(won,lost,nogo,budget,chart_name1);
                 }
             });           
        };

        function chart_data_department(year,department){
            $.ajax({
                 url: '@Url.Action("GetDataDepartment", "Home")',
                 type: "post",
                 contentType: 'application/x-www-form-urlencoded',
                 data: {
                     year,department
                 },
                 success: function (response) {
                     Datas = response.datas;
                     Data_Stages = response.stages;
                     DataLastUpdateDepartment = response.day;
                     Data_Target = response.target;

                     var Hitting_Rates = response.hittingrates;
                    

                     //===================== start global variable ===================

                     // Quotation
                     var product_department = {};
                     var project_department = {};
                     var service_department = {};

                     var _product = Datas.find(x => x.type === "Product" && x.stages === "");
                     var _project = Datas.find(x => x.type === "Project" && x.stages === "");
                     var _service = Datas.find(x => x.type === "Service" && x.stages === "");
                     if (typeof _product !== 'undefined') {
                         product_department = _product;
                     }
                     if (typeof _project !== 'undefined') {
                         project_department = _project;
                     }
                     if (typeof _service !== 'undefined') {
                         service_department = _service;
                     }

                     //Target
                     var target_product = "0";
                     var target_project = "0";
                     var target_service = "0";
                     if (Data_Target.sale_name !== null){
                          target_product = Data_Target.product;
                          target_project = Data_Target.project;
                          target_service = Data_Target.service;
                     }

                     var target = {};
                     var quotation = {};

                     target.product = target_product;
                     target.project = target_project;
                     target.service = target_service;
                     quotation.product = product_department; 
                     quotation.project = project_department; 
                     quotation.service = service_department; 

                     // Pending ALL , Pending IN
                     var pending_in = {};
                     var pending_all = {};

                     var _pending_in_product = Datas.find(x => x.type === "Product" && x.stages === "Pending In");
                     var _pending_in_project = Datas.find(x => x.type === "Project" && x.stages === "Pending In");
                     var _pending_in_service = Datas.find(x => x.type === "Service" && x.stages === "Pending In");
                     var _pending_all_product = Datas.find(x => x.type === "Product" && x.stages === "Pending");
                     var _pending_all_project = Datas.find(x => x.type === "Project" && x.stages === "Pending");
                     var _pending_all_service = Datas.find(x => x.type === "Service" && x.stages === "Pending");
                    
                     if (typeof _pending_in_product !== 'undefined') {
                         pending_in.product = _pending_in_product;
                     }else{
                         pending_in.product = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_in_project !== 'undefined') {
                         pending_in.project = _pending_in_project;
                     }else{
                          pending_in.project = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_in_service !== 'undefined') {
                         pending_in.service = _pending_in_service;
                     }else{
                          pending_in.service = {'mb':'0','cnt':'0'};
                     }

                     if (typeof _pending_all_product !== 'undefined') {
                         pending_all.product = _pending_all_product;
                     }else{
                         pending_all.product = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_all_project !== 'undefined') {
                         pending_all.project = _pending_all_project;
                     }else{
                          pending_all.project = {'mb':'0','cnt':'0'};
                     }
                     if (typeof _pending_all_service !== 'undefined') {
                         pending_all.service = _pending_all_service;
                     }else{
                          pending_all.service = {'mb':'0','cnt':'0'};
                     }


                     //===================== end global variable ===================

                     //draw target
                     
                     UpdatePieChartTarget(target_product,target_project,target_service,"pie_chart_target_department");

                      //draw quotation vs target

                     var chart_name = "chart_quotation_target_department";
                     var quotation = {product_department,project_department,service_department};

                     UpdateChartBarQuotation_Target_Department(quotation,target,chart_name);

                     //draw pending all vs pending in
                     
                     var chart_name = "chart_pending_all_pending_in_department";                    

                     UpdateChartBarPending_all_Pending_In_Department(pending_all,pending_in,chart_name);

                     // draw quotation
                     
                     UpdatePieChartQuotation(product_department,project_department,service_department,"pie_chart_type_department");
                    
                     // draw Won

                     var won_product = {};
                     var won_project = {};
                     var won_service = {};

                     var _won_product = Datas.find(x => x.type === "Product" && x.stages === "Closed(Won)");
                     var _won_project = Datas.find(x => x.type === "Project" && x.stages === "Closed(Won)");
                     var _won_service = Datas.find(x => x.type === "Service" && x.stages === "Closed(Won)");

                     if (typeof _won_product !== 'undefined') {
                         won_product = _won_product;
                     }
                     if (typeof _won_project !== 'undefined') {
                         won_project = _won_project;
                     }
                     if (typeof _won_service !== 'undefined') {
                         won_service = _won_service;
                     }
                     UpdatePieChartWon(won_product,won_project,won_service,"pie_chart_won_department");

                     //draw target vs won

                     var chart_name = "chart_target_won_department";
                     var won = {'product': won_product,'project': won_project,'service': won_service};
                     UpdateChartBarTarget_Won_Department(target,won,chart_name);

                     //draw reamin target vs pending in

                     var chart_name = "chart_remaintarget_pending_in_department";
                     var remain_target_product = (target.product - won_product.mb).toFixed(2);
                     var remain_target_project = (target.project - won_project.mb).toFixed(2);
                     var remain_target_service = (target.service - won_service.mb).toFixed(2);
                     var remain_target = {'product':remain_target_product,'project':remain_target_project,'service':remain_target_service};

                     UpdateChartBarRemainTarget_PendingIn_Department(remain_target,pending_in,chart_name);

                     //draw lost

                     var lost_product = {};
                     var lost_project = {};
                     var lost_service = {};

                     var _lost_product = Datas.find(x => x.type === "Product" && x.stages === "Closed(Lost)");
                     var _lost_project = Datas.find(x => x.type === "Project" && x.stages === "Closed(Lost)");
                     var _lost_service = Datas.find(x => x.type === "Service" && x.stages === "Closed(Lost)");

                     if (typeof _lost_product !== 'undefined') {
                         lost_product = _lost_product;
                     }
                     if (typeof _lost_project !== 'undefined') {
                         lost_project = _lost_project;
                     }
                     if (typeof _lost_service !== 'undefined') {
                         lost_service = _lost_service;
                     }
                     UpdatePieChartLost(lost_product,lost_project,lost_service,"pie_chart_lost_department");
                    
                     //draw won vs lost
                     var chart_name = "chart_won_lost_department";
                     var won = {'product':won_product,'project':won_project,'service':won_service};
                     var lost = {'product':lost_product,'project':lost_project,'service':lost_service};

                     UpdateChartBarWon_Lost_Department(won,lost,chart_name);

                     // draw nogo

                     var nogo_product = {};
                     var nogo_project = {};
                     var nogo_service = {};

                     var _nogo_product = Datas.find(x => x.type === "Product" && x.stages === "No go");
                     var _nogo_project = Datas.find(x => x.type === "Project" && x.stages === "No go");
                     var _nogo_service = Datas.find(x => x.type === "Service" && x.stages === "No go");

                     if (typeof _nogo_product !== 'undefined') {
                         nogo_product = _nogo_product;
                     }
                     if (typeof _nogo_project !== 'undefined') {
                         nogo_project = _nogo_project;
                     }
                     if (typeof _nogo_service !== 'undefined') {
                         nogo_service = _nogo_service;
                     }
                     UpdatePieChartNogo(nogo_product,nogo_project,nogo_service,"pie_chart_nogo_department");

                     //draw pending all
                     UpdatePieChartPending(pending_all.product,pending_all.project,pending_all.service,"pie_chart_pending_department");

                     //draw pending in
                     UpdatePieChartPendingIn(pending_in.product,pending_in.project,pending_in.service,"pie_chart_pending_in_department");

                     // draw all stages
                     var stages_won = {};
                     var stages_lost = {};
                     var stages_negotiation_review = {};
                     var stages_nogo = {};
                     var stages_quote_for_budget = {};
                     var stages_proposal = {};
                     var stages_prospectng = {};

                     var _stages_won = Data_Stages.find(x => x.stages === "Closed(Won)");
                     var _stages_lost = Data_Stages.find(x => x.stages === "Closed(Lost)");
                     var _stages_negotiation_review = Data_Stages.find(x => x.stages === "Negotiation/Review");
                     var _stages_nogo = Data_Stages.find(x => x.stages === "No go");
                     var _stages_quote_for_budget = Data_Stages.find(x => x.stages === "Quote for Budget");
                     var _stages_proposal = Data_Stages.find(x => x.stages === "Proposal/Quote for Order");
                     var _stages_prospectng = Data_Stages.find(x => x.stages === "Prospecting");

                     if (typeof _stages_won !== 'undefined') {
                         stages_won = _stages_won;
                     }
                     if (typeof _stages_lost !== 'undefined') {
                         stages_lost = _stages_lost;
                     }
                     if (typeof _stages_negotiation_review !== 'undefined') {
                         stages_negotiation_review = _stages_negotiation_review;
                     }
                     if (typeof _stages_nogo !== 'undefined') {
                         stages_nogo = _stages_nogo;
                     }
                     if (typeof _stages_quote_for_budget !== 'undefined') {
                         stages_quote_for_budget = _stages_quote_for_budget;
                     }
                     if (typeof _stages_proposal !== 'undefined') {
                         stages_proposal = _stages_proposal;
                     }
                     if (typeof _stages_prospectng !== 'undefined') {
                         stages_prospectng = _stages_prospectng;
                     }
                     UpdatePieChartStages(stages_quote_for_budget,stages_negotiation_review,stages_proposal,
                     stages_prospectng,stages_won,stages_lost,stages_nogo,"pie_chart_stages_department");       
                    
                     //hitting rate
                     UpdateChartHittingRateDepartment(Hitting_Rates,"chart_hitting_rate_department");

                     //stack bar
                     UpdateDepartmentStack(DataLastUpdateDepartment);

                     //draw stage Quote for Budget
                     var quote_product = {};
                     var quote_project = {};
                     var quote_service = {};

                     var _quote_product = Datas.find(x => x.type === "Product" && x.stages === "Quote for Budget");
                     var _quote_project = Datas.find(x => x.type === "Project" && x.stages === "Quote for Budget");
                     var _quote_service = Datas.find(x => x.type === "Service" && x.stages === "Quote for Budget");

                     if (typeof _quote_product !== 'undefined') {
                         quote_product = _quote_product;
                     }
                     if (typeof _quote_project !== 'undefined') {
                         quote_project = _quote_project;
                     }
                     if (typeof _quote_service !== 'undefined') {
                         quote_service = _quote_service;
                     }
                     UpdatePieChartQuoteForBudget(quote_product,quote_project,quote_service,"pie_chart_quotebudget_department");

                     // draw won & lost VS No go  | draw won & lost vs no go & budget

                     var chart_name = "chart_stack_wonlost_nogo_department";
                     var won = {'product':won_product,'project':won_project,'service':won_service};
                     var lost = {'product':lost_product,'project':lost_project,'service':lost_service};
                     var nogo = {'product':nogo_product,'project':nogo_project,'service':nogo_service};
                     var budget = {'product':quote_product,'project':quote_project,'service':quote_service};

                     var chart_name1 = "chart_stack_wonlost_nogobudget_department";
                     UpdateChartStackWonLost_NOGO_Department(won,lost,nogo,chart_name);
                     UpdateChartStackWonLost_NOGOBudget_Department(won,lost,nogo,budget,chart_name1);
                 
                 }
             });           
        };

        function UpdatePieChartTarget(product,project,service,chart_name){
           var datas = [
			        {y: product, label: "Product", legendText: "Product", color:"#550080"},
			        {y: project, label: "Project", legendText: "Project", color:"#aa00ff"},
			        {y: service, label: "Service", legendText: "Service", color:"#dd99ff"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart_type = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Target",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB",
		        dataPoints: datas,               
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart_type.render();           
        };

        function UpdatePieChartQuotation(product,project,service,chart_name){
           var datas = [
			        {y: product.mb, count:product.cnt, label: "Product", legendText: "Product", color:"#41384D"},
			        {y: project.mb, count:project.cnt, label: "Project", legendText: "Project", color:"#725A7A"},
			        {y: service.mb, count:service.cnt, label: "Service", legendText: "Service", color:"#B8AAC3"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart_type = new CanvasJS.Chart(chart_name, {
	        animationEnabled: false,
            backgroundColor: "transparent",
	        title: {
		        text: "Quotation",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_type"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_type_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart_type.render();           
        };

        function UpdatePieChartWon(won_product,won_project,won_service,chart_name) {
           var datas = [
			        {y: won_product.mb, count:won_product.cnt, label: "Product", legendText: "Product", color:"#205D5E"},
			        {y: won_project.mb, count:won_project.cnt, label: "Project", legendText: "Project", color:"#3F7857"},
			        {y: won_service.mb, count:won_service.cnt, label: "Service", legendText: "Service", color:"#7EC384"},
		            ];
            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Won",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_won"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_won_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();
        };
     
        function UpdatePieChartLost(lost_product,lost_project,lost_service,chart_name) {
           var datas = [
			        {y: lost_product.mb, count:lost_product.cnt, label: "Product", legendText: "Product", color:"#7E0306"},
			        {y: lost_project.mb, count:lost_project.cnt, label: "Project", legendText: "Project", color:"#D53E0F"},
			        {y: lost_service.mb, count:lost_service.cnt, label: "Service", legendText: "Service", color:"#FA8744"},
		            ];
            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Lost",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_lost"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_lost_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();           
        };

        function UpdatePieChartNogo(nogo_product,nogo_project,nogo_service,chart_name) {
           var datas = [
			        {y: nogo_product.mb, count:nogo_product.cnt, label: "Product", legendText: "Product", color:"#686868"},
			        {y: nogo_project.mb, count:nogo_project.cnt, label: "Project", legendText: "Project", color:"#A6A6A6"},
			        {y: nogo_service.mb, count:nogo_service.cnt, label: "Service", legendText: "Service", color:"#D3D3D3"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "No go",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_nogo"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_nogo_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();  
        };

        function UpdatePieChartPending(pending_product,pending_project,pending_service,chart_name) {
           var datas = [
			        {y: pending_product.mb, count:pending_product.cnt, label: "Product", legendText: "Product", color:"#C78B05"},
			        {y: pending_project.mb, count:pending_project.cnt, label: "Project", legendText: "Project", color:"#FFC000"},
			        {y: pending_service.mb, count:pending_service.cnt, label: "Service", legendText: "Service", color:"#F8E07E"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Pending ALL",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_pending"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_pending_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();           
        };
        function UpdatePieChartPendingIn(pending_product,pending_project,pending_service,chart_name) {
           var datas = [
			        {y: pending_product.mb, count:pending_product.cnt, label: "Product", legendText: "Product", color:"#C78B05"},
			        {y: pending_project.mb, count:pending_project.cnt, label: "Project", legendText: "Project", color:"#FFC000"},
			        {y: pending_service.mb, count:pending_service.cnt, label: "Service", legendText: "Service", color:"#F8E07E"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Pending In",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_pending_in"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_pending_in_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();           
        };

        function UpdatePieChartQuoteForBudget(product,project,service,chart_name) {
           var datas = [
			        {y: product.mb, count:product.cnt, label: "Product", legendText: "Product", color:"#0000cc"},
			        {y: project.mb, count:project.cnt, label: "Project", legendText: "Project", color:"#3333ff"},
			        {y: service.mb, count:service.cnt, label: "Service", legendText: "Service", color:"#6666ff"},
		            ];

            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Quote For Budget",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 240,
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_quotebudget"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_quotebudget_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            }
            });
            pie_chart.render();           
        };
        function UpdatePieChartStages(stages_quote_for_budget,stages_negotiation_review,stages_proposal,stages_prospectng,stages_won,stages_lost,stages_nogo,chart_name) {
           var datas = [			       			        
                    {y: stages_quote_for_budget.mb, count:stages_quote_for_budget.cnt, label: "Quote for Budget", legendText: "Quote for Budget", color:"#083470"},
			        {y: stages_negotiation_review.mb, count:stages_negotiation_review.cnt, label: "Negotiation/Review", legendText: "Negotiation/Review", color:"#1C4C97"},
			        {y: stages_proposal.mb, count:stages_proposal.cnt, label: "Proposal/Quote for Order", legendText: "Proposal/Quote for Order", color:"#2484C6"},
                    {y: stages_prospectng.mb, count:stages_prospectng.cnt, label: "Prospecting", legendText: "Prospecting", color:"#84C2ED"},
                    {y: stages_won.mb, count:stages_won.cnt, label: "Closed(Won)", legendText: "Closed(Won)", color:"#D6D6D6"},
                    {y: stages_lost.mb, count:stages_lost.cnt, label: "Closed(Lost)", legendText: "Closed(Lost)", color:"#B0B0B0"},
			        {y: stages_nogo.mb, count:stages_nogo.cnt, label: "No go", legendText: "No go", color:"#7D7D7D"},
		            ];
            // filter value more than 0
            datas = datas.filter(x => x.y > 0);

            var pie_chart = new CanvasJS.Chart(chart_name, {
	        animationEnabled: true,
            backgroundColor: "transparent",
	        title: {
		        text: "Stages",
                fontColor: "black",
                fontSize: "24",
                fontStyle: "normal",
                fontFamily: "angsana-new"
	        },
	        data: [{
		        type: "pie",
                showInLegend: true,
		        startAngle: 0,
                radius: "75%",
		        yValueFormatString: "##0.00\"\"",
		        indexLabel: "{label} : {y} MB , {count} Quo.",
                indexLabelFontColor: "black",
                toolTipContent: "{label} : {y} MB , {count} Quo.",
		        dataPoints: datas,
                cursor: "pointer",
                explodeOnClick: false,
                click: function(e){

                    if (chart_name === "pie_chart_stages"){
                        var year = document.getElementById("years_dashboard").value;
                        var name = document.getElementById("sale_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByIndividual(year,name,type,data);
                    }else if (chart_name === "pie_chart_stages_department"){
                        var year = document.getElementById("years_dashboard_department").value;
                        var department = document.getElementById("department_name").value;
                        var type = e.chart.title.text;
                        var data = e.dataPoint.label;
                        GetQuotationByDepartment(year,department,type,data);
                    }
                },
	        }],
            legend: {
                horizontalAlign: "center",
                verticalAlign: "bottom",
                fontStyle: "normal",
                fontColor: "black",
            },
            toolTip:{
                fontColor: "black",
            },
            });
            pie_chart.render(); 
        };

        var performance_stack;
        function UpdatePerformanceStack(datas){
            if (performance_stack != null){
                performance_stack.destroy();

            }
            var chartName = "performance_bar";
            var ctx = document.getElementById(chartName).getContext('2d');

            var names = [];
            var products_target = [];
            var products_actual = [];
            var projects_target = [];
            var projects_actual = [];
            var services_target = [];
            var services_actual = [];

            //get datas
            for (var i =0; i<datas.length;i++){
                names.push(datas[i].sale_name);
                products_target.push(datas[i].product_target);
                products_actual.push(datas[i].product_actual);
                projects_target.push(datas[i].project_target);
                projects_actual.push(datas[i].project_actual);
                services_target.push(datas[i].service_target);
                services_actual.push(datas[i].service_actual);
            }
            var labels = names;
            const data = {
                              labels: labels,
                              datasets: [
                                {
                                  label: 'Product Target',
                                  data: products_target,
                                  backgroundColor: '#203864',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Product Actual',
                                  data: products_actual,
                                  backgroundColor: '#034594',
                                  stack: 'Stack 1',
                                },
                                {
                                  label: 'Project Target',
                                  data: projects_target,
                                  backgroundColor: '#1E83C6',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Project Actual',
                                  data: projects_actual,
                                  backgroundColor: '#84C2ED',
                                  stack: 'Stack 1',
                                },
                                {
                                  label: 'Service Target',
                                  data: services_target,
                                  backgroundColor: '#A6A6A6',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Service Actual',
                                  data: services_actual,
                                  backgroundColor: '#D6D6D6',
                                  stack: 'Stack 1',
                                },
                              ],
                        };

                        const options = {
                              plugins: {
                                title: {
                                  display: false,
                                  text: 'Performance',
                                  color: '#FFFFFFC8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    label += context.parsed.y + ' MB';
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#FFFFFFC8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#FFFFFFC8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#FFFFFFC8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                }
                              }

                        };
                        performance_stack = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        function PopulateDataBarChart(datas) {
            $(function () {
                if (bar_chart_stages != null)
                    bar_chart_stages.destroy();
                var chartName = "bar_chart_stages";
                var ctx = document.getElementById(chartName).getContext('2d');
                var _datas = [datas.no_data,datas.day_0, datas.day_7, datas.day_14, datas.day_30, datas.day_60];

                var type = ["No Data","< 7 Day", "< 14 Day", "< 30 Day","< 60 Day","> 60 Day"];

                var bg_colors = ['#D8D8D8', '#F1F48F', '#E2D445', '#DEA824', '#DE8124', '#E35812'];
                var border_colors = ['#D8D8D8','#F1F48F', '#E2D445', '#DEA824', '#DE8124', '#E35812'];
                var data = {
                    datasets: [
                        {
                            data: _datas,
                            backgroundColor: bg_colors,
                            borderColor: border_colors,
                            borderWidth: 2,
                        }
                    ],
                    labels: type
                }
                var options = {
                    maintainAspectRatio: false,
                    scales: {
                        yAxes: {
                            id: 'first-y-axis',
                            position: 'left',
                            type: 'linear',
                            scaleLabel: { display: true, labelString: 'Count' },
                            gridLines: { display: true, color:'#000000C8'},
                            ticks: { min: 0, beginAtZero: true,
                                color: '#000000C8',
                                font: {
                                    size: 14
                                },
                            },
                        },
                        xAxes: {
                            ticks: {
                                min: 0, beginAtZero: true,
                                color: '#000000C8',
                                font: {
                                    size: 14
                                },
                            },
                            scaleLabel: { display: true, labelString: 'Quo.' },
                            gridLines: { display: false }
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: "Pending Quotation",
                            color: '#000000C8',
                            font: {
                                size: 20
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                        if (label) {
                                            label += ' : ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += context.raw + ' Quo.';
                                        }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            display: false,
                            labels: {
                                color: '#000000C8',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    onHover: (event, chartElement) => {
                        event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                    },
                    onClick: BarChartClick
                };
                bar_chart_stages = new Chart(ctx, { type: 'bar', data: data, options: options });
            });
        };
        function BarChartClick(evt, point) {
            $("#table_stages").empty();
            var name = document.getElementById("sale_name").value;
            var year = document.getElementById("years_dashboard").value;
            if (point.length > 0) {
                var index = point[0].index;
                var day = "";
                if (index == 0){
                    day = "no data";
                }else if (index == 1) {
                    day = " < 7";
                } else if (index == 2) {
                    day = "between 7 and 13";
                } else if (index == 3) {
                    day = "between 14 and 29";
                } else if (index == 4) {
                    day = "between 30 and 59";
                } else if (index == 5) {
                    day = " >= 60";
                }

                $.ajax({
                    url: '@Url.Action("GetStagesDay", "Home")',
                    type: "post",
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        year,name, day
                    },
                    success: function (response) {
                        var datas = response;
                        var dataSet = [];
                        for (var i = 0; i < datas.length; i++) {
                            var data = [
                                datas[i].quotation_no,
                                datas[i].quote_price,
                                datas[i].stages_update_date];
                            dataSet.push(data);
                        }
                        table(dataSet);
                    }
                });
            }
        };

        var chart_hitting_rate_individual;
        function UpdateChartHittingRateIndividual(Hitting_Rates,chart_name) {

            if (chart_hitting_rate_individual != null)
                chart_hitting_rate_individual.destroy();
            
            var product = Hitting_Rates.filter(f=>f.type == "Product").map(m=>m.hitting_rate)[0];
            var project = Hitting_Rates.filter(f=>f.type == "Project").map(m=>m.hitting_rate)[0];
            var service = Hitting_Rates.filter(f=>f.type == "Service").map(m=>m.hitting_rate)[0];
            var total = Hitting_Rates.filter(f=>f.type == "Total").map(m=>m.hitting_rate)[0];
            
            if (typeof product === "undefined"){
                product = 0;
            }
            if (typeof project === "undefined"){
                project = 0;
            }
            if (typeof service === "undefined"){
                service = 0;
            }
            if (typeof total === "undefined"){
                total = 0;
            }
            var datas = [product,project,service,total];

            var type = [ "Product", "Project", "Service","Total"];

            var bg_colors = ['#41384D', '#725A7A', '#B8AAC3','#FFFFCC'];
            var border_colors = ['#41384D', '#725A7A', '#B8AAC3','#FFFFCC'];

            chart_hitting_rate_individual = new Chart(chart_name, {
                type: 'polarArea',
                data: {
                    datasets: [
                        {
                            data: datas,
                            backgroundColor: bg_colors,
                            borderColor: border_colors,
                            borderWidth: 2,
                        }
                    ],
                    labels: type
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Hitting Rate',
                            color: '#000000C8',
                            font: {
                                size: 24
                            },
                        },
                        legend: {
                            position: 'bottom',
                            display: true,
                            labels: {
                                color: '#000000C8',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.raw;
                                    if (label) {
                                        label = type[context.dataIndex] + ' : ' + label + ' %';
                                    }
                                    return label;
                                }
                            }
                        },
                    },
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            pointLabels: {
                                color: 'rgba(0,0,0,0.8)',
                            },
                            grid: {
                                    color: 'rgba(0,0,0,0.8)'
                            },
                            angleLines: {
                                    color: "gray"
                            },
                        }
                    }
                }
            });
        };

        var chart_hitting_rate_department;
        function UpdateChartHittingRateDepartment(Hitting_Rates,chart_name) {

            if (chart_hitting_rate_department != null)
                chart_hitting_rate_department.destroy();
            
            var product = Hitting_Rates.filter(f=>f.type == "Product").map(m=>m.hitting_rate)[0];
            var project = Hitting_Rates.filter(f=>f.type == "Project").map(m=>m.hitting_rate)[0];
            var service = Hitting_Rates.filter(f=>f.type == "Service").map(m=>m.hitting_rate)[0];
            var total = Hitting_Rates.filter(f=>f.type == "Total").map(m=>m.hitting_rate)[0];
            
            if (typeof product === "undefined"){
                product = 0;
            }
            if (typeof project === "undefined"){
                project = 0;
            }
            if (typeof service === "undefined"){
                service = 0;
            }
            if (typeof total === "undefined"){
                total = 0;
            }
            var datas = [product,project,service,total];

            var type = [ "Product", "Project", "Service","Total"];

            var bg_colors = ['#41384D', '#725A7A', '#B8AAC3','#FFFFCC'];
            var border_colors = ['#41384D', '#725A7A', '#B8AAC3','#FFFFCC'];

            chart_hitting_rate_department = new Chart(chart_name, {
                type: 'polarArea',
                data: {
                    datasets: [
                        {
                            data: datas,
                            backgroundColor: bg_colors,
                            borderColor: border_colors,
                            borderWidth: 2,
                        }
                    ],
                    labels: type
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Hitting Rate',
                            color: '#000000FC8',
                            font: {
                                size: 24
                            },
                        },
                        legend: {
                            position: 'bottom',
                            display: true,
                            labels: {
                                color: '#000000FC8',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.raw;
                                    if (label) {
                                        label = type[context.dataIndex] + ' : ' + label + ' %';
                                    }
                                    return label;
                                }
                            }
                        },
                    },
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            pointLabels: {
                                color: 'rgba(0,0,0,0.8)',
                            },
                            grid: {
                                    color: 'rgba(0,0,0,0.8)'
                            },
                            angleLines: {
                                    color: "gray"
                            },
                        }
                    }
                }
            });
        };

        var chartbar_pending_all_pending_in;
        function UpdateChartBarPending_all_Pending_In(pending_all,pending_in,chart_name){           
            if (chartbar_pending_all_pending_in != null){
                chartbar_pending_all_pending_in.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [pending_all.product.mb,pending_all.project.mb,pending_all.service.mb],
                                label: "Pending ALL",
                                borderColor: 'rgb(216, 174, 80)',
                                backgroundColor: 'rgba(216, 174, 80,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [pending_in.product.mb,pending_in.project.mb,pending_in.service.mb],
                                label: "Pending IN",
                                fill: false,
                                borderColor: 'rgb(255, 211, 77)',
                                backgroundColor: 'rgba(255, 211, 77,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Pending ALL VS Pending IN",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Pending ALL"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Pending IN"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.service.cnt + ' Quo.';
                                                        }
                                                    }                                                    
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                            
                        chartbar_pending_all_pending_in = new Chart(ctx, { type: 'bar', data: data, options: options });
        };
   
        var chartbar_quotation_target;
        function UpdateChartBarQuotation_Target(quotation,target,chart_name){           
            if (chartbar_quotation_target != null){
                chartbar_quotation_target.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [quotation.product.mb,quotation.project.mb,quotation.service.mb],
                                label: "Quotation",
                                borderColor: 'rgb(81, 68, 85)',
                                backgroundColor: 'rgba(81, 68, 85,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [target.product,target.project,target.service],
                                label: "Target",
                                fill: false,
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Quotation VS Target",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Quotation"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + quotation.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + quotation.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + quotation.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_quotation_target = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_target_won;
        function UpdateChartBarTarget_Won(target,won,chart_name){           
            if (chartbar_target_won != null){
                chartbar_target_won.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [target.product,target.project,target.service],
                                label: "Target",
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [won.product.mb,won.project.mb,won.service.mb],
                                label: "Won",
                                fill: false,
                                borderColor: 'rgb(0, 153, 0)',
                                backgroundColor: 'rgba(0, 153, 0,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Target VS Won",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }else if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_target_won = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_remaintarget_pendingin;
        function UpdateChartBarRemainTarget_PendingIn(remain_target,pending_in,chart_name){           
            if (chartbar_remaintarget_pendingin != null){
                chartbar_remaintarget_pendingin.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [remain_target.product,remain_target.project,remain_target.service],
                                label: "Remain Target",
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [pending_in.product.mb,pending_in.project.mb,pending_in.service.mb],
                                label: "Pending IN",
                                fill: false,
                                borderColor: 'rgb(255, 211, 77)',
                                backgroundColor: 'rgba(255, 211, 77,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Remain Target VS Pending IN",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Remain Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }else if (context.dataset.label === "Pending IN"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.service.cnt + ' Quo.';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_remaintarget_pendingin = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_won_lost;
        function UpdateChartBarWon_Lost(won,lost,chart_name){           
            if (chartbar_won_lost != null){
                chartbar_won_lost.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [won.product.mb,won.project.mb,won.service.mb],
                                label: "Won",
                                borderColor: 'rgb(0, 153, 0)',
                                backgroundColor: 'rgba(0, 153, 0,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                label: "Lost",
                                fill: false,
                                borderColor: 'rgb(226, 120, 87)',
                                backgroundColor: 'rgba(226, 120, 87,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Won VS Lost",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_won_lost = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chart_stack_wonlost_nogo;
        function UpdateChartStackWonLost_NOGO(won,lost,nogo,chart_name){
            if (chart_stack_wonlost_nogo != null){
                chart_stack_wonlost_nogo.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');

            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [
                                {
                                  label: 'Won',
                                  data: [won.product.mb,won.project.mb,won.service.mb],
                                  backgroundColor: 'rgb(0, 153, 0)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Lost',
                                  data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                  backgroundColor: 'rgb(226, 120, 87)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'No go',
                                  data: [nogo.product.mb,nogo.project.mb,nogo.service.mb],
                                  backgroundColor: 'rgb(204, 204, 204)',
                                  stack: 'Stack 1',
                                },
                              ],
                        };

                        const options = {
                             maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: 'Won & Lost VS No Go',
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "No go"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + nogo.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + nogo.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + nogo.service.cnt + ' Quo.';
                                                        }
                                                    }         
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  },
                                },
                                
                              }

                        };
                        chart_stack_wonlost_nogo = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chart_stack_wonlost_nogobudget;
        function UpdateChartStackWonLost_NOGOBudget(won,lost,nogo,budget,chart_name){
            if (chart_stack_wonlost_nogobudget != null){
                chart_stack_wonlost_nogobudget.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');

            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [
                                {
                                  label: 'Won',
                                  data: [won.product.mb,won.project.mb,won.service.mb],
                                  backgroundColor: 'rgb(0, 153, 0)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Lost',
                                  data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                  backgroundColor: 'rgb(226, 120, 87)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'No go',
                                  data: [nogo.product.mb,nogo.project.mb,nogo.service.mb],
                                  backgroundColor: 'rgb(204, 204, 204)',
                                  stack: 'Stack 1',
                                },
                                {
                                  label: 'Budget',
                                  data: [budget.product.mb,budget.project.mb,budget.service.mb],
                                  backgroundColor: 'rgb(0, 92, 230)',
                                  stack: 'Stack 1',
                                },
                              ],
                        };

                        const options = {
                             maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: 'Won & Lost VS No Go & Budget',
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "No go"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + nogo.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + nogo.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + nogo.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Budget"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + budget.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + budget.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + budget.service.cnt + ' Quo.';
                                                        }
                                                    }      
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  },
                                },
                                
                              }

                        };
                        chart_stack_wonlost_nogobudget = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        function GetQuotationByIndividual(year,name,type,data){
             $.ajax({
                 url: '@Url.Action("GetQuotationByIndividual", "Home")',
                 type: "post",
                 contentType: 'application/x-www-form-urlencoded',
                 data: {
                     year,name,type,data
                 },
                 success: function (response) {
                     var datas = response.quotation;
                        var dataSet = [];
                        for (var i = 0; i < datas.length; i++) {
                            var d = [
                                datas[i].quotation_no,
                                datas[i].quoted_price];
                            dataSet.push(d);
                        }
                     tableQuotation(dataSet);

                     document.getElementById("quotation_title").innerHTML = type + "-" + data;
                     document.getElementById("quotation_title").style.fontWeight = "bold";
                     $('#ShowQuotationModal').modal();
                 }
             });
        };

        // Dashboard Department

        var stages_department_stack;
        function UpdateDepartmentStack(datas){
            if (stages_department_stack != null){
                stages_department_stack.destroy();

            }
            var chartName = "bar_chart_stages_department";
            var ctx = document.getElementById(chartName).getContext('2d');

            var names = [];
            var no_data = [];
            var day_0 = [];
            var day_7 = [];
            var day_14 = [];
            var day_30 = [];
            var day_60 = [];

            var fontsize = 14;

            var department = document.getElementById("department_name").value;
            if (department === "ALL"){
                fontsize = 8;
            }

            //get datas
            for (var i =0; i<datas.length;i++){
                names.push(datas[i].sale_name);
                no_data.push(datas[i].no_data);
                day_0.push(datas[i].day_0);
                day_7.push(datas[i].day_7);
                day_14.push(datas[i].day_14);
                day_30.push(datas[i].day_30);
                day_60.push(datas[i].day_60);
            }
            var labels = names;
            const data = {
                              labels: labels,                             
                              datasets: [
                                {
                                  label: '> 60 Day',
                                  data: day_60,
                                  backgroundColor: '#E35812',
                                },
                                {
                                  label: '> 30 Day',
                                  data: day_30,
                                  backgroundColor: '#DE8124',
                                },
                                {
                                  label: '> 14 Day',
                                  data: day_14,
                                  backgroundColor: '#DEA824',
                                },
                                {
                                  label: '> 7 Day',
                                  data: day_7,
                                  backgroundColor: '#E2D445',
                                },
                                {
                                  label: '> 0 Day',
                                  data: day_0,
                                  backgroundColor: '#F1F48F',
                                },
                                {
                                  label: 'No Data',
                                  data: no_data,
                                  backgroundColor: '#D8D8D8',
                                },
                              ],
                        };

                        const options = {
                              indexAxis: 'y',
                              maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: 'Pending Quotation',
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    label += context.raw + ' Quo.';
                                                }
                                            return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#000000C8',
                                        font: {
                                            size: 14
                                        },
                                 
                                    },
                                    display: false
                                }
                              },
                              @*interaction: {
                                  intersect: false,
                              },*@
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: fontsize
                                    },
                                  },
                                  grid: {
                                      color: '#00000088'
                                  }
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: fontsize
                                    },
                                  },
                                  grid: {
                                      color: '#00000088'
                                  }
                                }
                              },
                              onHover: (event, chartElement) => {
                                event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                              },
                              onClick: LastUpdateDepartmentClick

                        };
                        stages_department_stack = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        function LastUpdateDepartmentClick(evt,point) {
            
            var year = document.getElementById("years_dashboard_department").value;       
            $("#table_stages_department").empty();
            if (point.length > 0) {
                var day = "";
                var name = DataLastUpdateDepartment[point[0].index].sale_name;
                var dataIndex = stages_department_stack._active[0].datasetIndex;
                if (dataIndex == 5){
                    day = "no data";
                }else if (dataIndex == 4) {
                    day = " < 7";
                } else if (dataIndex == 3) {
                    day = "between 7 and 13";
                } else if (dataIndex == 2) {
                    day = "between 14 and 29";
                } else if (dataIndex == 1) {
                    day = "between 30 and 59";
                } else if (dataIndex == 0) {
                    day = " >= 60";
                }

                $.ajax({
                    url: '@Url.Action("GetStagesDay", "Home")',
                    type: "post",
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        year,name, day
                    },
                    success: function (response) {
                        var datas = response;
                        var dataSet = [];
                        for (var i = 0; i < datas.length; i++) {
                            var data = [
                                datas[i].quotation_no,
                                datas[i].quote_price,
                                datas[i].stages_update_date];
                            dataSet.push(data);
                        }
                        tableLastUpdateDepartment(dataSet);
                    }
                });
            }
        };

        var chartbar_pending_all_pending_in_department;
        function UpdateChartBarPending_all_Pending_In_Department(pending_all,pending_in,chart_name){           
            if (chartbar_pending_all_pending_in_department != null){
                chartbar_pending_all_pending_in_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [pending_all.product.mb,pending_all.project.mb,pending_all.service.mb],
                                label: "Pending ALL",
                                borderColor: 'rgb(216, 174, 80)',
                                backgroundColor: 'rgba(216, 174, 80,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [pending_in.product.mb,pending_in.project.mb,pending_in.service.mb],
                                label: "Pending IN",
                                fill: false,
                                borderColor: 'rgb(255, 211, 77)',
                                backgroundColor: 'rgba(255, 211, 77,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Pending ALL VS Pending IN",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Pending ALL"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_all.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Pending IN"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.service.cnt + ' Quo.';
                                                        }
                                                    }         
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_pending_all_pending_in_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };
   
        var chartbar_quotation_target_department;
        function UpdateChartBarQuotation_Target_Department(quotation,target,chart_name){           
            if (chartbar_quotation_target_department != null){
                chartbar_quotation_target_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [quotation.product_department.mb,quotation.project_department.mb,quotation.service_department.mb],
                                label: "Quotation",
                                borderColor: 'rgb(81, 68, 85)',
                                backgroundColor: 'rgba(81, 68, 85,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [target.product,target.project,target.service],
                                label: "Target",
                                fill: false,
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Quotation VS Target",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Quotation"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + quotation.product_department.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + quotation.project_department.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + quotation.service_department.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_quotation_target_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_target_won_department;
        function UpdateChartBarTarget_Won_Department(target,won,chart_name){           
            if (chartbar_target_won_department != null){
                chartbar_target_won_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [target.product,target.project,target.service],
                                label: "Target",
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [won.product.mb,won.project.mb,won.service.mb],
                                label: "Won",
                                fill: false,
                                borderColor: 'rgb(0, 153, 0)',
                                backgroundColor: 'rgba(0, 153, 0,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Target VS Won",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }else if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }      
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_target_won_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_remaintarget_pendingin_department;
        function UpdateChartBarRemainTarget_PendingIn_Department(remain_target,pending_in,chart_name){           
            if (chartbar_remaintarget_pendingin_department != null){
                chartbar_remaintarget_pendingin_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [remain_target.product,remain_target.project,remain_target.service],
                                label: "Remain Target",
                                borderColor: 'rgb(196, 77, 255)',
                                backgroundColor: 'rgba(196, 77, 255,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [pending_in.product.mb,pending_in.project.mb,pending_in.service.mb],
                                label: "Pending IN",
                                fill: false,
                                borderColor: 'rgb(255, 211, 77)',
                                backgroundColor: 'rgba(255, 211, 77,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Remain Target VS Pending IN",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Remain Target"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB';
                                                        }
                                                    }else if (context.dataset.label === "Pending IN"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + pending_in.service.cnt + ' Quo.';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_remaintarget_pendingin_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chartbar_won_lost_department;
        function UpdateChartBarWon_Lost_Department(won,lost,chart_name){           
            if (chartbar_won_lost_department != null){
                chartbar_won_lost_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [{
                                type: 'bar',                               
                                data: [won.product.mb,won.project.mb,won.service.mb],
                                label: "Won",
                                borderColor: 'rgb(0, 153, 0)',
                                backgroundColor: 'rgba(0, 153, 0,0.8)'
                              }, {
                                type: 'bar',                              
                                data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                label: "Lost",
                                fill: false,
                                borderColor: 'rgb(226, 120, 87)',
                                backgroundColor: 'rgba(226, 120, 87,0.8)'
                              }]
                        };

                        const options = {
                            maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: "Won VS Lost",
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }        
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: false,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  }
                                }
                              }
                        };
                        chartbar_won_lost_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chart_stack_wonlost_nogo_department;
        function UpdateChartStackWonLost_NOGO_Department(won,lost,nogo,chart_name){
            if (chart_stack_wonlost_nogo_department != null){
                chart_stack_wonlost_nogo_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');

            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [
                                {
                                  label: 'Won',
                                  data: [won.product.mb,won.project.mb,won.service.mb],
                                  backgroundColor: 'rgb(0, 153, 0)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Lost',
                                  data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                  backgroundColor: 'rgb(226, 120, 87)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'No go',
                                  data: [nogo.product.mb,nogo.project.mb,nogo.service.mb],
                                  backgroundColor: 'rgb(204, 204, 204)',
                                  stack: 'Stack 1',
                                },
                              ],
                        };

                        const options = {
                             maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: 'Won & Lost VS No Go',
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "No go"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + nogo.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + nogo.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + nogo.service.cnt + ' Quo.';
                                                        }
                                                    }
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  },
                                },
                                
                              }

                        };
                        chart_stack_wonlost_nogo_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var chart_stack_wonlost_nogobudget_department;
        function UpdateChartStackWonLost_NOGOBudget_Department(won,lost,nogo,budget,chart_name){
            if (chart_stack_wonlost_nogobudget_department != null){
                chart_stack_wonlost_nogobudget_department.destroy();
            }
            var ctx = document.getElementById(chart_name).getContext('2d');

            const data = {
                              labels: ["Product","Project","Service"],
                              datasets: [
                                {
                                  label: 'Won',
                                  data: [won.product.mb,won.project.mb,won.service.mb],
                                  backgroundColor: 'rgb(0, 153, 0)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'Lost',
                                  data: [lost.product.mb,lost.project.mb,lost.service.mb],
                                  backgroundColor: 'rgb(226, 120, 87)',
                                  stack: 'Stack 0',
                                },
                                {
                                  label: 'No go',
                                  data: [nogo.product.mb,nogo.project.mb,nogo.service.mb],
                                  backgroundColor: 'rgb(204, 204, 204)',
                                  stack: 'Stack 1',
                                },
                                {
                                  label: 'Budget',
                                  data: [budget.product.mb,budget.project.mb,budget.service.mb],
                                  backgroundColor: 'rgb(0, 92, 230)',
                                  stack: 'Stack 1',
                                },
                              ],
                        };

                        const options = {
                             maintainAspectRatio: false,
                              plugins: {
                                title: {
                                  display: true,
                                  text: 'Won & Lost VS No Go & Budget',
                                  color: '#000000C8',
                                  font: {
                                        size: 16
                                    }
                                },
                                tooltip: {
                                       callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ' : ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    if (context.dataset.label === "Won"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + won.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + won.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + won.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Lost"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + lost.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + lost.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + lost.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "No go"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + nogo.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + nogo.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + nogo.service.cnt + ' Quo.';
                                                        }
                                                    }else if (context.dataset.label === "Budget"){
                                                        if (context.label === "Product"){
                                                            label += context.parsed.y + ' MB , ' + budget.product.cnt + ' Quo.';
                                                        }else if(context.label === "Project"){
                                                            label += context.parsed.y + ' MB , ' + budget.project.cnt + ' Quo.';
                                                        }else if(context.label === "Service"){
                                                            label += context.parsed.y + ' MB , ' + budget.service.cnt + ' Quo.';
                                                        }
                                                    }
                                                }
                                                return label;
                                        }
                                    }
                                },
                                legend: {
                                    labels: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    }
                                },
                                }
                              },
                              interaction: {
                                  intersect: false,
                              },
                              responsive: true,
                              scales: {
                                x: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                },
                                y: {
                                  stacked: true,
                                  ticks: {
                                    color: '#000000C8',
                                    font: {
                                        size: 14
                                    },
                                  },
                                  title: {
                                      text: 'MB',
                                      display: true
                                  },
                                },
                                
                              }

                        };
                        chart_stack_wonlost_nogobudget_department = new Chart(ctx, { type: 'bar', data: data, options: options });
        };

        var tables_quotation;
        function tableQuotation(dataSet) {
            if (tables_quotation !== undefined)
                tables_quotation.destroy();
                tables_quotation = $('#view_table_quotation').DataTable({
                data: dataSet,
                columns: [
                    { title: "Quotation"},
                    { title: "Value (MB)"},
                ],
                "columnDefs": [
                    {
                        "targets": [0, 1],
                        "className": "dt-center",
                    },
                ],
                "paging": false,
                "searching": false,
                "bInfo": false,
                "scrollX": true,
                "ordering":false,
                "fixedHeader":true,
            });
            $(tables_quotation.table().body()).addClass('text-dark');
        }

        var tables;
        function table(dataSet) {
            if (tables !== undefined)
                tables.destroy();
                tables = $('#table_stages').DataTable({
                data: dataSet,
                columns: [
                    { title: "Quotation"},
                    { title: "Value (MB)"},
                    { title: "Last Update (Day)" },
                ],
                "columnDefs": [
                    {
                        "targets": [0, 1, 2],
                        "className": "dt-center",
                    },
                ],
                "paging": false,
                "searching": false,
                "bInfo": false,
                "scrollX": true,
                "ordering":false,
                "fixedHeader":true,
            });
            $(tables.table().body()).addClass('text-dark');
        }

        var tables_Lastupdate_department;
        function tableLastUpdateDepartment(dataSet) {
            if (tables_Lastupdate_department !== undefined)
                tables_Lastupdate_department.destroy();
                tables_Lastupdate_department = $('#table_stages_department').DataTable({
                data: dataSet,
                columns: [
                    { title: "Quotation"},
                    { title: "Value (MB)"},
                    { title: "Last Update (Day)" },
                ],
                "columnDefs": [
                    {
                        "targets": [0, 1, 2],
                        "className": "dt-center",

                    },
                ],
                "paging": false,
                "searching": false,
                "bInfo": false,
                "scrollX": true,
                 "ordering":false,
                "fixedHeader":true,
            });
            $(tables_Lastupdate_department.table().body()).addClass('text-dark');
        };

        var tables_performance;
        function tablePerformance(dataSet) {
            setTimeout(()=>{
                if (tables_performance !== undefined)
                    tables_performance.destroy();
                tables_performance = $('#table_performance').DataTable({
                    data: dataSet,
                    "columnDefs": [
                        {
                            "targets": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                            "className": "text-center",
                        },
                    ],
                    "createdRow": function (row, data, index) {
                        if (data[0] === "Total") {
                            $('td', row).css('background-color', '#E3C871');
                            $('td', row).addClass('highlight');
                        }
                    },
                    "paging": false,
                    "searching": false,
                    "bInfo": false,
                    "scrollX": true,
                    "ordering":false,
            });

            $(tables_performance.table().body()).addClass('text-dark');
            },100);
        };

        function initPerformanceStack(datas){
                    var dataSet = [];
                    var total_target = 0;
                    var total_actual = 0;
                    for (var i = 0; i < datas.length; i++) {
                           var sum_target = (parseFloat(datas[i].product_target) + parseFloat(datas[i].project_target) +  parseFloat(datas[i].service_target)).toFixed(3);
                           var sum_actual = (parseFloat(datas[i].product_actual) + parseFloat(datas[i].project_actual) +  parseFloat(datas[i].service_actual)).toFixed(3);
                           var percent = ((sum_actual / sum_target) * 100).toFixed(2);
                           total_target += parseFloat(sum_target);
                           total_actual += parseFloat(sum_actual);
                           var data = [
                               datas[i].sale_name,
                               sum_target,
                               sum_actual,
                               percent
                               ];

                           dataSet.push(data);
                       }
                       var total_percent = ((total_actual / total_target) *100).toFixed(2);
                       dataSet.push(["Total",total_target.toFixed(3),total_actual.toFixed(3),total_percent]);
                    tablePerformanceStack(dataSet);
        };
        var tables_performance_stack;
        function tablePerformanceStack(dataSet) {
            setTimeout(()=>{
                if (tables_performance_stack !== undefined)
                    tables_performance_stack.destroy();

                tables_performance_stack = $('#table_performance_stack').DataTable({
                data: dataSet,
                "columnDefs": [
                    {
                        "targets": [0, 1, 2, 3],
                        "className": "text-center",
                    },
                ],
                 "createdRow": function (row, data, index) {
                    if (data[0] === "Total") {
                        $('td', row).css('background-color', '#E3C871');
                        $('td', row).addClass('highlight');
                    }
                },
                "paging": false,
                "searching": false,
                "bInfo": false,
                "scrollX": true,
                "ordering":false,
            });

            $(tables_performance_stack.table().body()).addClass('text-dark');
            },100);
        };

        var tables_engineer_view;
        function table_engineer_view(dataSet) {
            setTimeout(function () {
                if (tables_engineer_view !== undefined)
                    tables_engineer_view.destroy();
                tables_engineer_view = $('#table_engineer_in_charge_view').DataTable({
                    data: dataSet,
                    columns: [
                        { title: "Engineer", width: 120 },
                        { title: "Department", width: 120 },
                    ],
                    "columnDefs": [                        
                    ],
                    "scrollX": true,
                    "paging": false,
                    "searching": false,
                    "bInfo": false,
                });
                $(tables_engineer_view.table().body()).addClass('text-dark');
            }, 300);
        };

        var tables_view;
        function table_view(dataSet) {
                setTimeout(function () {
                    if (tables_view !== undefined)
                        tables_view.destroy();
                        tables_view = $('#view_table_types').DataTable({
                        data: dataSet,
                        columns: [
                            { title: "Type", width: 80 },
                            { title: "Brand", width: 80 },
                            { title: "Part No", width: 80 },
                            { title: "Spec", width: 80 },
                            { title: "Quantity", width: 80 },
                            { title: "Supplier Quotation No", width: 80 },
                            { title: "Total Value", width: 80 },
                            { title: "Unit", width: 30 },
                        ],
                        "scrollX": true,
                        "paging": false,
                        "searching": false,
                        "bInfo": false,

                    });
                    $(tables_view.table().body()).addClass('text-dark');
                }, 300);
        };

        function GetQuotationByDepartment(year,department,type,data){
             $.ajax({
                 url: '@Url.Action("GetQuotationByDepartment", "Home")',
                 type: "post",
                 contentType: 'application/x-www-form-urlencoded',
                 data: {
                     year,department,type,data
                 },
                 success: function (response) {
                     var datas = response.quotation;
                        var dataSet = [];
                        for (var i = 0; i < datas.length; i++) {
                            var d = [
                                datas[i].quotation_no,
                                datas[i].quoted_price];
                            dataSet.push(d);
                        }
                     tableQuotation(dataSet);

                     document.getElementById("quotation_title").innerHTML = type + "-" + data;
                     document.getElementById("quotation_title").style.fontWeight = "bold";
                     $('#ShowQuotationModal').modal();
                 }
             });
        };


        function add_department(departments) {
                var data_departments = [];
                for (var i = 0; i < departments.length; i++) {
                    var data =
                    {
                        "text": departments[i].department,
                        "value": departments[i].department,
                    }
                    data_departments.push(data);
                }

                return data_departments;
        };
        function add_sale(sales) {
                var data_sales = [];
                for (var i = 0; i < sales.length; i++) {
                    var data =
                    {
                        "text": sales[i].name,
                        "value": sales[i].name,
                    }
                    data_sales.push(data);
                }

                return data_sales;
        };
        function add_year(years) {
                var data_years = [];
                for (var i = 0; i < years.length; i++) {
                    var data =
                    {
                        "text": years[i],
                        "value": years[i],
                    }
                    data_years.push(data);
                }

                return data_years;
        };
    </script>
}
